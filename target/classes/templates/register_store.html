<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">

<head>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />

	<title>Promocon - Cadastro</title>

	<link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} " />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script>

		function limpa_formulário_cep() {
			//Limpa valores do formulário de cep.
			document.getElementById('rua').value = ("");
			document.getElementById('bairro').value = ("");
			document.getElementById('cidade').value = ("");
			document.getElementById('uf').value = ("");
		}

		function meu_callback(conteudo) {
			if (!("erro" in conteudo)) {
				//Atualiza os campos com os valores.
				document.getElementById('rua').value = (conteudo.logradouro);
				document.getElementById('bairro').value = (conteudo.bairro);
				document.getElementById('cidade').value = (conteudo.localidade);
				document.getElementById('uf').value = (conteudo.uf);
			} //end if.
			else {
				//CEP não Encontrado.
				limpa_formulário_cep();
				alert("CEP não encontrado.");
			}
		}

		function pesquisacep(valor) {

			//Nova variável "cep" somente com dígitos.
			var cep = valor.replace(/\D/g, '');

			//Verifica se campo cep possui valor informado.
			if (cep != "") {

				//Expressão regular para validar o CEP.
				var validacep = /^[0-9]{8}$/;

				//Valida o formato do CEP.
				if (validacep.test(cep)) {

					//Preenche os campos com "..." enquanto consulta webservice.
					document.getElementById('rua').value = "...";
					document.getElementById('bairro').value = "...";
					document.getElementById('cidade').value = "...";
					document.getElementById('uf').value = "...";

					//Cria um elemento javascript.
					var script = document.createElement('script');

					//Sincroniza com o callback.
					script.src = 'https://viacep.com.br/ws/' + cep + '/json/?callback=meu_callback';

					//Insere script no documento e carrega o conteúdo.
					document.body.appendChild(script);

				} //end if.
				else {
					//cep é inválido.
					limpa_formulário_cep();
					alert("Formato de CEP inválido.");
				}
			} //end if.
			else {
				//cep sem valor, limpa formulário.
				limpa_formulário_cep();
			}
		};
	</script>

</head>

<style>
	html,
	body {
		height: 100%;
	}

	.form-registry {
		background-color: #EDEDED;
		padding-top: 10px;
		padding-bottom: 20px;
		padding-left: 20px;
		padding-right: 20px;
		border-radius: 15px;
		border-color: #d2d2d2;
		border-width: 5px;
		box-shadow: 0 1px 0 #cfcfcf;
	}

	.container {
		height: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
	}
</style>

<body>

	<div class="container">
		<div class="row">
			<div class="col">
				<div class="form-registry">
					<form class="form" th:action="@{/loja/salvar}" role="form" method="post" th:object="${store}">
						<div class="form-group">
							<label>Informações gerais</label>
							<input type="text" id="name" th:field="*{name}" name="name" size="40" class="form-control"
								placeholder="Nome" required>

							<br>
							<label>Localização</label>
							<input name="cep" type="text" id="cep" th:field="*{zip}" value="" maxlength="9"
								onblur="pesquisacep(this.value)" class="form-control" placeholder="Cep" required>
							<input name="rua" type="text" id="rua" th:field="*{street}" class="form-control"
								placeholder="Rua" required>
							<input name="numero" type="text" id="numero" th:field="*{number}" class="form-control"
								placeholder="Número" required>
							<input name="bairro" type="text" id="bairro" th:field="*{district}" class="form-control"
								placeholder="Bairro" required>
							<input name="cidade" type="text" id="cidade" th:field="*{city}" class="form-control"
								placeholder="Cidade" readonly>
							<input name="uf" type="text" id="uf" th:field="*{state}" class="form-control"
								placeholder="UF" readonly>
						</div>
						<div style="text-align: center;">
							<span class="group-btn">
								<button type="submit" class="btn btn-primary btn-md">Cadastrar</button>
							</span>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<script th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
	<script th:src="@{/webjars/popper.js/1.12.9-1/umd/popper.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/4.0.0-2/js/bootstrap.min.js}"></script>

</body>

</html>